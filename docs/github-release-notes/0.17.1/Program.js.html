<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Program.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GitHubInfo.html">GitHubInfo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GitHubInfo.html#_executeCommand">_executeCommand</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GitHubInfo.html#_repo">_repo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GitHubInfo.html#_token">_token</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Gren.html">Gren</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_checkChangelogFile">_checkChangelogFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_createChangelog">_createChangelog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_createRelease">_createRelease</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_createReleaseRanges">_createReleaseRanges</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_editRelease">_editRelease</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_filterBlockIssue">_filterBlockIssue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_filterBlockPullRequest">_filterBlockPullRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_filterCommit">_filterCommit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_filterIssue">_filterIssue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_filterPullRequest">_filterPullRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_generateCommitsBody">_generateCommitsBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getAllTags">_getAllTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getClosedIssues">_getClosedIssues</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getCommitBlocks">_getCommitBlocks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getCommitsBetweenTwo">_getCommitsBetweenTwo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getIssueBlocks">_getIssueBlocks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getLastPage">_getLastPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getLastTags">_getLastTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getListReleases">_getListReleases</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getMergedPullRequests">_getMergedPullRequests</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getPullRequestsBlocks">_getPullRequestsBlocks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getReleaseBlocks">_getReleaseBlocks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getSelectedTags">_getSelectedTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_getTagDates">_getTagDates</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_groupBy">_groupBy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_groupByLabel">_groupByLabel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_hasNetwork">_hasNetwork</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_lablesAreIgnored">_lablesAreIgnored</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_listReleases">_listReleases</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_listTags">_listTags</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_outputOptions">_outputOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_prepareRelease">_prepareRelease</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_sortReleasesByDate">_sortReleasesByDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_templateBody">_templateBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_templateCommits">_templateCommits</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_templateGroups">_templateGroups</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_templateIssue">_templateIssue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_templateLabels">_templateLabels</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#_validateRequiredTagsExists">_validateRequiredTagsExists</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#changelog">changelog</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Gren.html#release">release</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Program.html">Program</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_camelCaseObjectKeys">_camelCaseObjectKeys</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_consumeOptions">_consumeOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_dashToCamelCase">_dashToCamelCase</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_filterObject">_filterObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_getEnvOptions">_getEnvOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_getOptionsFromObject">_getOptionsFromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_programWithEvents">_programWithEvents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_programWithOptions">_programWithOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#init">init</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#cleanConfig">cleanConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearTasks">clearTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#convertStringToArray">convertStringToArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#dashToCamelCase">dashToCamelCase</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#formatDate">formatDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generate">generate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getConfigFromFile">getConfigFromFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getConfigFromRemote">getConfigFromRemote</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFileExtension">getFileExtension</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFileNameFromPath">getFileNameFromPath</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getFileTypes">getFileTypes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getGrenConfig">getGrenConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getRemoteUrl">getRemoteUrl</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isInRange">isInRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#noop">noop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#printTask">printTask</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requireConfig">requireConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sortObject">sortObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#task">task</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#writeConfigToFile">writeConfigToFile</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">Program.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import GitHubInfo from './GitHubInfo';
import program from 'commander';
import { getGrenConfig } from './_utils.js';

/** Class creating a Commander program, managing the options passed via bash and config file. */
class Program {
    constructor(props) {
        const { programOptions, defaults } = this._consumeOptions(props.options);

        this.name = props.name;
        this.description = props.description;
        this.examples = props.examples;
        this.defaults = defaults;
        this.program = this._programWithEvents(this._programWithOptions(program, programOptions), props.events)
            .name(this.name)
            .description(this.description)
            .parse(props.argv);

        this.options = Object.assign(
            {},
            getGrenConfig(props.cwd, program.config),
            this._getOptionsFromObject(this.program, this.defaults)
        );
    }

    /**
     * Initialise the module
     *
     * @since 0.10.0
     * @public
     *
     * @return {Promise}
     */
    async init() {
        const options = await this._getEnvOptions();
        this.options = this._filterObject(this._camelCaseObjectKeys(
            Object.assign(
                {},
                this.defaults,
                Object.assign({}, ...[].concat(options)),
                this.options
            )
        ));

        return this.options;
    }

    /**
     * Get informations from the local folder
     *
     * @since 0.10.0
     * @private
     *
     * @return {Promise}
     */
    _getEnvOptions() {
        const githubInfo = new GitHubInfo();
        const { username, repo } = this.options;

        if (username &amp;&amp; repo) {
            return githubInfo.token;
        }

        return githubInfo.options;
    }

    /**
     * Remove all the properties that have undefined values from an object
     *
     * @since  0.10.0
     * @private
     *
     * @param  {Object} object
     *
     * @return {Object}
     */
    _filterObject(object) {
        return Object.entries(object)
            .filter(([key, value]) => value !== undefined)
            .reduce((carry, [key, value]) => {
                carry[key] = value;
                return carry;
            }, {});
    }

    /**
     * Add all the given events to a program
     *
     * @since  0.10.0
     * @private
     *
     * @param  {Commander} program
     * @param  {Object} events
     *
     * @return {Commander}
     */
    _programWithEvents(program, events) {
        if (!events || !events.length) {
            return program;
        }

        Object.entries(events).forEach(([event, action]) => {
            program.on(event, action);
        });

        return program;
    }

    /**
     * Add all the given options to a program
     *
     * @since 0.10.0
     * @private
     *
     * @param  {Commander} program
     * @param  {Array} options
     *
     * @return {Commander}
     */
    _programWithOptions(program, options) {
        options.forEach(({ name, description, action, defaultValue }) => program.option(...[name, description, action, defaultValue].filter(Boolean)));
        return program;
    }

    /**
     * Consume the options from the properties and provide get the defaults and the programOptions
     *
     * @since  0.10.0
     * @private
     *
     * @param  {Array} opts
     *
     * @return {Object}
     */
    _consumeOptions(opts = []) {
        if (!Array.isArray(opts)) {
            return {
                programOptions: [],
                defaults: {}
            };
        }

        const programOptions = opts.map(({ short, name, valueType, description, defaultValue, action }) => ({
            name: short &amp;&amp; name ? `${short}, --${name} ${valueType || ''}` : ' ',
            description,
            defaultValue,
            action
        }));

        const defaults = this._camelCaseObjectKeys(
            opts.reduce((carry, opt) => {
                carry[opt.name] = opt.defaultValue;
                return carry;
            }, {})
        );

        return {
            programOptions,
            defaults
        };
    }

    /**
     * Extrapulate the options from a program
     *
     * @since  0.10.0
     * @private
     *
     * @param  {Object} defaults
     *
     * @return {Object}
     */
    _getOptionsFromObject(object = {}, defaults = {}) {
        if (typeof object !== 'object' || Array.isArray(object)) {
            return {};
        }

        return Object.keys(defaults).reduce((carry, option) => {
            if (object[option] &amp;&amp; object[option] !== defaults[option]) {
                carry[option] = object[option];
            }

            return carry;
        }, {});
    }

    /**
     * Converts all Object values to camel case
     *
     * @param  {Object} object
     *
     * @return {Object}
     */
    _camelCaseObjectKeys(object = {}) {
        if (typeof object !== 'object' || Array.isArray(object)) {
            return {};
        }

        return Object.entries(object).reduce((carry, [key, value]) => {
            carry[this._dashToCamelCase(key)] = value;
            return carry;
        }, {});
    }

    /**
    * Transforms a dasherize string into a camel case one.
    *
    * @since 0.3.2
    * @private
    *
    * @param  {string} value The dasherize string
    *
    * @return {string}       The camel case string
    */
    _dashToCamelCase(value = '') {
        if (typeof value !== 'string') {
            return '';
        }

        return value
            .replace(/-([a-z])/g, (match) => match[1].toUpperCase());
    }
}

export default Program;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Thu Dec 12 2019 15:54:57 GMT+0100 (Central European Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
